
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Chase Your Dreams">
    <title>Puppeteer - No Strings Attached - Chase Your Dreams</title>
    <meta name="author" content="Yogendra Rampuria">
    
    
        <link rel="icon" href="http://yogendra.github.io/assets/images/favicon_32.png">
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yogendra Rampuria","sameAs":["https://github.com/yogendra","https://stackoverflow.com/users/559158/yogi","https://twitter.com/yogendra","https://facebook.com/yogendrarampuria","https://www.linkedin.com/in/yogi","mailto:yogendrarampuria@gmail.com"],"image":"https://www.gravatar.com/avatar/7ce74aebb97274e10ea8c5f2d9685abc"},"articleBody":"I am a Co-Manager for Google Developer Group - Singapore (FB). And today was our annual GDG-SG DevFest 2017 event. Apart from being an organizer, I was also a speaker. I gave a short talk on Puppeteer. This post is (almost) a transcript of my speech today. Slides can be found here\n\n\n\n\nOverviewPuppeteer is a Node JS API published by Chrome team. It is an API to control Chrome browser via DevTools Protocol. Puppeteer was released shortly after the Chrome 59. This version of Chrome brought us Headless Chrome. It requires Node JS version 6.4+. I would recommend using version 7.5+, so you can use async/await feature from ES2017.\nFeaturesIt connects with browser using Chrome DevTools Protocol. Hence, it works with Chrome/Chromium only, and not with other browsers.\nPuppeteer can work in headless environment. This makes it a good candidate tool for unit/acceptance/functional tests in a CI environment. It can simulate keyboard, mouse and touch events. So, if you are building a responsive application for desktop and mobile devices, you can use Puppeteer for testing. It also brings the PDF and screenshot capabilities out of box. You can capture PDF and screenshot for whole or part of the page.\nPuppeteer allows you to trap console output and web requests. If you have a requirement to “flag” any console output, you may put traps in your test cases for it. If you want to mock a back-end server request (json/xml), you can intercept those request and provide mock response for it.\nIt has API for performance tracing. So you can use it for recording page load performance and trace any bottlenecks. One of the biggest advantage, of having latest Chromium or Chrome being driven by the API, is Blink Engine. It is a shiny new layout engine from Chromium project and replaces WebKit engine. I am not aware about any short comings with WebKit, but I am guessing that Chromium has outgrown WebKit zone.\nUse casesI have found Puppeteer most useful in browser automation. I have done multiple personal projects for browser automation (I am a lazy guy). Puppeteer offers a simple clean API interface for this, and that in itself is a great selling point. You can use if for frontend testing, e2e testing, etc.\nServer side rendering (SSR) is another great use case for this API. You can easily render your single page applications’ view on server side and send them to client. This is very useful when you have deep nested view and deep-linking facility in your application.\nIf you have written apps in Spring Web MVC to produce PDF, you would be aware of maintenance nightmares. You had to maintain each View (HTML and PDF) separately. I eventually started using PhantomJS on server side and reused HTML view to generate PDF with it. You get absolutely great looking PDF out of box with Puppeteer. Its identical to what you get in the PDF print in regular Chrome.\nWeb crawling and scraping is one of the easiest things to do with Puppeteer. You can easily navigate to pages, retrieve details and process them in a nested fashion.\nPuppeteer And OthersBrowser automation and e2e testing is a very busy area. Lots of options for frameworks, APIs, Tools and Platforms. As a result, there are many competing tools in this space. Puppeteer emerges as a good replacement for a few of them.\nPhantomJSPhantomJS was one of the first tools that I used for headless browsing. I used it for generating server side PDF. However, recent events force us to move on to other tooling. Primary maintainer of PhantomJS, Vitaly, has stepped down. In his departing note, he expressed excitement about the new Headless Chrome experience. That’s fair! And I agree with his point of view.\nThe ‘Selenium’ EmpireSelenium is probably the most used browser automation and testing tool for frontend. It is the “Automation Emperor” for me. It has the most comprehensive coverage in terms of languages and target browsers. It has language binding for Java, Node, Ruby, Python, etc. You name it and it has language binding for it. And on the other side, it has web driver for every browser or browser like system. It has drivers for all browsers, Chrome, Safari, Firefox, Opera, etc. It also has drivers for like ok PhantomJS and Appium.\nThey have managed to achieve the most unimaginable feat. They have got these giants on a common footing. It enjoy a lot of love and support from community, including myself. So, why am I even talking about puppeteer.\nThat brings me nicely into the next piece. Architecture-wise Selenium and Puppeteer are slightly different. Selenium achieve browser automation though an intermediate proxy, the WebDriver. WebDriver is a per-browser component implementing remote control capabilities. It exposes an restful API interface. A language binding uses these APIs to interact and control browser.\n\nPuppeteer takes a leaner approach to this and taps straight into the DevTools protocol of the browser. This makes it possible to easily keep keep with browser features and automation API, in sync.\nDemoLets go through some samples to understand the development with Puppeteer.\nInstallationPuppeteer is a Node JS API. Its published as an NPM package. You can install it in you project with simple npm install\n12345678$ npm i --save-dev puppeteer&gt; puppeteer@0.12.0 install /Users/user/.nvm/project1/node_modules/puppeteer&gt; node install.jsDownloading Chromium r508693 - 72.6 Mb [====================] 100% 0.0sChromium downloaded to /Users/monkey/project1/lib/node_modules/puppeteer/.local-chromium/mac-508693+ puppeteer@0.12.0added 42 packages in 223.254s\n\nNotice how it has also downloaded Chromium. This ensures that it has a compatible version of chromium always. You can skip Chromium download and run it with your own installation of Chrome / Chromium. You can skip download by setting an PUPPETEER_SKIP_CHROMIUM_DOWNLOAD environment variable. And you can provide executable path to alternate Chrome or Chromium in you code.\nScreenshotTaking a screenshot in an automation tool is like a “Hello World!” thing.\nscreenshot.js12345678910\"use strict\";const puppeteer = require(\"puppeteer\");(async () =&gt; &#123;  const browser = await puppeteer.launch();  const page = await browser.newPage();  await page.goto(\"https://www.google.com\", &#123; waitUntil: \"networkidle\" &#125;);  await page.screenshot(&#123; path: \"screenshot.png\" &#125;);  await browser.close();&#125;)();\n\nSource\nIf you are not familiar with async/await, I would recommend reading this. Most methods in Puppeteer API return a Promise. await ensures that you wait for a promise to resolve or reject before proceeding to next instruction. Line 5, invokes launch(), which launches Chromium. You can specify launch options as an object parameter, like puppeteer.launch({headless: false}). See all the options in documentation page. Line 6 creates a new tab with newPage() method. goto() method on line 7 navigates page to a URL. waitUntil ensures that page and its and related assets (js/images/css) are loaded, before promise is resolved.\nOn line 10-12, screenshot() method captures an image of output and stores it in screenshot.png. This looks plain and simple. And that is what made me like this API. It is clean and simple.\nYou can run this with following command\n12$ node screenshot.js$\n\nThis produces screenshot.png in the current directory.\n\nPDFThis is the single biggest reason for me to use Puppeteer. PDF generation is a breeze! Heres how you can do it.\npdf.js12345678910111213\"use strict\";const puppeteer = require(\"puppeteer\");(async () =&gt; &#123;  const browser = await puppeteer.launch();  const page = await browser.newPage();  await page.goto(\"https://news.ycombinator.com\", &#123; waitUntil: \"networkidle\" &#125;);  await page.pdf(&#123;    path: \"hn.pdf\",    format: \"A4\",  &#125;);  await browser.close();&#125;)();\n\nSource\nWe will now generate PDF from hacker news landing page. Code is not very different from what we saw in screenshot example. Line 20-23 generates PDF instead of screenshot. And thats it. You can specify paper size for the PDF in the optional argument. Look at documentation for more options. Its output would be identical to “Print PDF” function of Chrome or Chromium. It uses print media css.\nLink to actual extracted PDF\nWeb ScrapingI have used Puppeteer most for this. In my work environment I have need for integration via web pages. There are case where I don’t have access to a data API for integration. Puppeteer can make it possible for you to expose a “web” site as a JSON api.\nscrape.js123456789101112131415161718192021222324252627`use strict`;const SELECTOR_BOOK_IMAGE =  \"#default &gt; div &gt; div &gt; div &gt; div &gt; section &gt; div:nth-child(2) &gt; ol &gt; li:nth-child(1) &gt; article &gt; div.image_container &gt; a &gt; img\";const puppeteer = require(\"puppeteer\");let scrape = async () =&gt; &#123;  const browser = await puppeteer.launch(&#123; headless: false &#125;);  const page = await browser.newPage();  await page.goto(\"http://books.toscrape.com/\");  await page.waitFor(1000);  await page.click(SELECTOR_BOOK_IMAGE);  await page.waitFor(2000);  const result = await page.evaluate(() =&gt; &#123;    let title = document.querySelector(\"h1\").innerText;    let price = document.querySelector(\".price_color\").innerText;    return &#123;      title,      price,    &#125;;  &#125;);  await browser.close();  return result;&#125;;scrape().then((value) =&gt; &#123;  console.log(value); // Success!&#125;);\n\nSource\nWe first goto “books.toscrape.com” and click on first image (line 11) on the page. First image on page is referred via SELECTOR_BOOK_IMAGE css selector. This triggers a navigation to a details page.\nOn line 13, a function is dispatched for evaluation on the DOM. This function goes through DOM element (h1 and element with class price_color ) and extracts text (innerText).\nYou can simply run this with node command.\n12$ node scrape.js&#123; title: 'A Light in the Attic', price: '£51.77' &#125;\n\nYou will see browser window for this example. This is because of line 7, where I have opted for {headless: false}. This is to show scraping in action.\nDisclaimer: Be very careful what you scrape. You can/will run into legal and licensing issues very quickly.\nFinal ThoughtsPuppeteer is a very promising project. In a very short period (&lt; 6 month) it has gotten great support from community. I have read many posts covering this API. I am confident about the future of this project. I am looking forward to a growing and thriving community for this.\nIt is a very good replacement for PhantomJS. However, my key concern as at the moment are:\n\nGoogle Cloud Function (GCF) does not support Node JS 6.4+. So, you have to use cloud VM or Container service to run this in cloud. Hopefully next version of LTS will be 8+, and will bring all the goodness of async/await into the mix\nLack of support for non-Chrome based browser could be discouraging for many developers. We all want to keep tool/library dependency low and single codebase for testing. If you project demands multi-browser testing, you will end up in a fractured state. Better stick with WebDriver/Selenium. May be WebDriver will adopt some part of Puppeteer API.\n\nI also found the e2e testing support very unclean. Its possible, workable, but now readable. I would like to see a very clean integration with likes of cucumber, mocha, chai, etc.\nLinksHere are some links that I used for preparing my presentation.\n\nPuppeteer Home\nTry Puppeteer in Browser\nPuppetron (Demo)\nGetting Started with Headless Chrome - Eric Bidelman\nGetting Started with Puppeteer and Headless Chrome Web Scraping - Emad Ehsan\nA Guide to Automating and Scraping - Brandon Morelli\n\nQuestionsCan I use Puppeteer for extracting data and localizing?Technically, Yes. You can setup data pipeline to crawl and extract data. You case store it in database or some other persistent store. You can use a workflow to review, edit and publish. Be very careful about licensing. Don’t crawl/scrape data without author’s consent.\nCan you run multiple tabs simultaneously?Yes. You can use newPage() method to create multiple tabs. And for each tab you can have a different execution code. I have tried it with 2 tabs. Here is a code sample for the last example (scraping) that does same thing but five times, concurrently.\nscrape-multi.js123456789101112131415161718192021222324252627282930313233343536const SELECTOR_BOOK_IMAGE =  \"#default &gt; div &gt; div &gt; div &gt; div &gt; section &gt; div:nth-child(2) &gt; ol &gt; li:nth-child(1) &gt; article &gt; div.image_container &gt; a &gt; img\";const puppeteer = require(\"puppeteer\");let scrapeSite = async (browser) =&gt; &#123;  const page = await browser.newPage();  await page.goto(\"http://books.toscrape.com/\");  await page.waitFor(1000);  await page.click(SELECTOR_BOOK_IMAGE);  await page.waitFor(2000);  const result = await page.evaluate(() =&gt; &#123;    let title = document.querySelector(\"h1\").innerText;    let price = document.querySelector(\".price_color\").innerText;    return &#123;      title,      price,    &#125;;  &#125;);  return result;&#125;;let scrape = async () =&gt; &#123;  const browser = await puppeteer.launch(&#123; headless: false &#125;);  const result = await Promise.all([    scrapeSite(browser),    scrapeSite(browser),    scrapeSite(browser),    scrapeSite(browser),    scrapeSite(browser),  ]);  await browser.close();  return result;&#125;;scrape().then((value) =&gt; &#123;  console.log(value); // Success!&#125;);\n\nSource\nCan I extract CSS from the pages with this?I have not tried it, but as you can evaluate any valid javascript code using API, you should be able to extract that.\nBelow is a code that dumps each css being accessed by the page.\nscrape-dump-css.js1234567891011121314151617181920212223const puppeteer = require(\"puppeteer\");let scrape = async () =&gt; &#123;  const browser = await puppeteer.launch(&#123; headless: false &#125;);  const page = await browser.newPage();  await page.setRequestInterceptionEnabled(true);  page.on(\"request\", (r) =&gt; &#123;    r.continue();  &#125;);  page.on(\"response\", (r) =&gt; &#123;    const url = r.url;    if (url.endsWith(\"css\")) &#123;      r.text().then((s) =&gt; &#123;        console.log(\"// Source:\" + url);        console.log(s);      &#125;);    &#125;  &#125;);  await page.goto(\"http://books.toscrape.com/\");  await browser.close();&#125;;scrape();\n\nSource\nThanksMy father (Shri. Noratan Rampuria) has always been very supportive of my life and career choices. And he showed his support once again. He was there for my talk and had looked happy. Thanks papa 🙏!\nMany ex and current colleagues were also at the event and showed their support. Thanks folks🤝!\nThanks to Bharathi and Hari (GDG Mangement team) for the opportunity to speak. Well, it was more like push to speak 😀. Manikantan K, Hui Yi, Dirk Primbs and David from Google Developer Relations for supporting GDG-SG - “Thank you”. And Jason Zaman for incepting the idea “Want to be at a conference? Just speak on something”.\n","dateCreated":"2017-10-28T15:52:08+00:00","dateModified":"2020-08-25T14:21:37+00:00","datePublished":"2017-10-28T15:52:08+00:00","description":"I am a Co-Manager for Google Developer Group - Singapore (FB). And today was our annual GDG-SG DevFest 2017 event. Apart from being an organizer, I was also a speaker. I gave a short talk on Puppeteer. This post is (almost) a transcript of my speech today. Slides can be found here","headline":"Puppeteer - No Strings Attached","image":["logo.png"],"mainEntityOfPage":{"@type":"WebPage","@id":"http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/"},"publisher":{"@type":"Organization","name":"Yogendra Rampuria","sameAs":["https://github.com/yogendra","https://stackoverflow.com/users/559158/yogi","https://twitter.com/yogendra","https://facebook.com/yogendrarampuria","https://www.linkedin.com/in/yogi","mailto:yogendrarampuria@gmail.com"],"image":"https://www.gravatar.com/avatar/7ce74aebb97274e10ea8c5f2d9685abc","logo":{"@type":"ImageObject","url":"https://www.gravatar.com/avatar/7ce74aebb97274e10ea8c5f2d9685abc"}},"url":"http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/","keywords":"gdg, testing","thumbnailUrl":"logo.png"}</script>
    <meta name="description" content="I am a Co-Manager for Google Developer Group - Singapore (FB). And today was our annual GDG-SG DevFest 2017 event. Apart from being an organizer, I was also a speaker. I gave a short talk on Puppeteer">
<meta name="keywords" content="gdg,testing">
<meta property="og:type" content="blog">
<meta property="og:title" content="Puppeteer - No Strings Attached">
<meta property="og:url" content="http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/index.html">
<meta property="og:site_name" content="Chase Your Dreams">
<meta property="og:description" content="I am a Co-Manager for Google Developer Group - Singapore (FB). And today was our annual GDG-SG DevFest 2017 event. Apart from being an organizer, I was also a speaker. I gave a short talk on Puppeteer">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/gdg-collage.jpg">
<meta property="og:image" content="http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/slides.001.jpeg">
<meta property="og:image" content="http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/slides.012.jpeg">
<meta property="og:image" content="http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/screenshot.png">
<meta property="og:image" content="http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/hn.jpg">
<meta property="og:image" content="http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/special-thanks.jpg">
<meta property="og:updated_time" content="2020-08-25T14:21:37.776Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Puppeteer - No Strings Attached">
<meta name="twitter:description" content="I am a Co-Manager for Google Developer Group - Singapore (FB). And today was our annual GDG-SG DevFest 2017 event. Apart from being an organizer, I was also a speaker. I gave a short talk on Puppeteer">
<meta name="twitter:image" content="http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/gdg-collage.jpg">
<meta name="twitter:creator" content="@yogendra">
    
    
        
    
    
        <meta property="og:image" content="https://www.gravatar.com/avatar/7ce74aebb97274e10ea8c5f2d9685abc?s=640"/>
    
    
        <meta property="og:image" content="http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/logo.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/logo.png"/>
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-7tzu0ct5vop2qi4mhoifkrbobtkjwjqdy1vdgyojtumjjo45ba7hnlfjb3sd.min.css">
    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-21164716-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-21164716-2');
    </script>


    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/ "
            aria-label=""
        >
            Chase Your Dreams
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="https://www.gravatar.com/avatar/7ce74aebb97274e10ea8c5f2d9685abc?s=90" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->


    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/7ce74aebb97274e10ea8c5f2d9685abc?s=110" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Yogendra Rampuria</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Software Engineer<br>OSS Advocate, User, Buyer and Seller.<br>GPG: 019ECB5CDC6D59B7 </p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/projects"
                            
                            title="Projects"
                        >
                    
                        <i class="sidebar-button-icon fa fa-project-diagram" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Projects</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="Categories"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="Tags"
                        >
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="Archives"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                            title="About"
                        >
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/security.html"
                            
                            title="Security"
                        >
                    
                        <i class="sidebar-button-icon fa fa-shield-alt" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Security</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/yogendra" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://stackoverflow.com/users/559158/yogi" target="_blank" rel="noopener" title="Stack Overflow">
                    
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://twitter.com/yogendra" target="_blank" rel="noopener" title="Twitter">
                    
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://facebook.com/yogendrarampuria" target="_blank" rel="noopener" title="Facebook">
                    
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/yogi" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:yogendrarampuria@gmail.com" target="_blank" rel="noopener" title="Mail">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                            title="RSS"
                        >
                    
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Puppeteer - No Strings Attached
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2017-10-28T15:52:08+00:00">
	
		    Oct 28, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Talk/">Talk</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>I am a Co-Manager for <a href="https://www.gdg-sg.org" target="_blank" rel="noopener">Google Developer Group - Singapore</a> (<a href="https://www.facebook.com/gdgsgorg" target="_blank" rel="noopener">FB</a>). And today was our annual <a href="https://www.gdg-sg.org/2017/10/gdg-devfest-2017.html" target="_blank" rel="noopener">GDG-SG DevFest 2017</a> event. Apart from being an organizer, I was also a speaker. I gave a short talk on <a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener">Puppeteer</a>. This post is (almost) a transcript of my speech today. Slides can be found <a href="https://drive.google.com/open?id=0B6Mr-G5qbPLPT0JCTWl0N0w5M2s" target="_blank" rel="noopener">here</a></p>
<a id="more"></a>

<p><img src="gdg-collage.jpg" alt="GDG-SG"></p>
<p><img src="slides.001.jpeg" alt></p>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p><a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener">Puppeteer</a> is a <a href="https://www.nodejs.org" target="_blank" rel="noopener">Node JS</a> API published by Chrome team. It is an API to control Chrome browser via <a href="https://github.com/ChromeDevTools/devtools-protocol" target="_blank" rel="noopener">DevTools Protocol</a>. Puppeteer was released shortly after the Chrome 59. This version of Chrome brought us <a href="https://chromium.googlesource.com/chromium/src/+/lkgr/headless/README.md" target="_blank" rel="noopener">Headless Chrome</a>. It requires <a href="https://www.nodejs.org" target="_blank" rel="noopener">Node JS</a> version 6.4+. I would recommend using version 7.5+, so you can use <code>async/await</code> feature from <a href="https://medium.com/@tmvvr/ecmascript-async-await-to-the-rescue-fc379ff89146" target="_blank" rel="noopener">ES2017</a>.</p>
<h3 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h3><p>It connects with browser using <a href="https://chromedevtools.github.io/devtools-protocol/" target="_blank" rel="noopener">Chrome DevTools Protocol</a>. Hence, it works with <a href="https://www.google.com/chrome" target="_blank" rel="noopener">Chrome</a>/<a href="https://www.chromium.org" target="_blank" rel="noopener">Chromium</a> only, and not with other browsers.</p>
<p>Puppeteer can work in headless environment. This makes it a good candidate tool for unit/acceptance/functional tests in a CI environment. It can simulate keyboard, mouse and touch events. So, if you are building a responsive application for desktop and mobile devices, you can use Puppeteer for testing. It also brings the PDF and screenshot capabilities out of box. You can capture PDF and screenshot for whole or part of the page.</p>
<p>Puppeteer allows you to trap console output and web requests. If you have a requirement to “flag” any console output, you may put traps in your test cases for it. If you want to mock a back-end server request (json/xml), you can intercept those request and provide mock response for it.</p>
<p>It has API for performance tracing. So you can use it for recording page load performance and trace any bottlenecks. One of the biggest advantage, of having latest Chromium or Chrome being driven by the API, is <a href="https://www.chromium.org/Blink" target="_blank" rel="noopener">Blink Engine</a>. It is a shiny new layout engine from Chromium project and replaces <a href="https://webkit.org" target="_blank" rel="noopener">WebKit</a> engine. I am not aware about any short comings with WebKit, but I am guessing that Chromium has outgrown WebKit zone.</p>
<h3 id="Use-cases"><a href="#Use-cases" class="headerlink" title="Use cases"></a>Use cases</h3><p>I have found Puppeteer most useful in browser automation. I have done multiple personal projects for browser automation (I am a lazy guy). Puppeteer offers a simple clean API interface for this, and that in itself is a great selling point. You can use if for frontend testing, e2e testing, etc.</p>
<p>Server side rendering (SSR) is another great use case for this API. You can easily render your single page applications’ view on server side and send them to client. This is very useful when you have deep nested view and deep-linking facility in your application.</p>
<p>If you have written apps in Spring Web MVC to produce PDF, you would be aware of maintenance nightmares. You had to maintain each View (HTML and PDF) separately. I eventually started using PhantomJS on server side and reused HTML view to generate PDF with it. You get absolutely great looking PDF out of box with Puppeteer. Its identical to what you get in the PDF print in regular Chrome.</p>
<p>Web crawling and scraping is one of the easiest things to do with Puppeteer. You can easily navigate to pages, retrieve details and process them in a nested fashion.</p>
<h2 id="Puppeteer-And-Others"><a href="#Puppeteer-And-Others" class="headerlink" title="Puppeteer And Others"></a>Puppeteer And Others</h2><p>Browser automation and e2e testing is a very busy area. Lots of options for frameworks, APIs, Tools and Platforms. As a result, there are many competing tools in this space. Puppeteer emerges as a good replacement for a few of them.</p>
<h3 id="PhantomJS"><a href="#PhantomJS" class="headerlink" title="PhantomJS"></a>PhantomJS</h3><p><a href="https://phantomjs.org" target="_blank" rel="noopener">PhantomJS</a> was one of the first tools that I used for headless browsing. I used it for generating server side PDF. However, recent events force us to move on to other tooling. Primary maintainer of PhantomJS, Vitaly, has stepped down. In his departing note, he expressed excitement about the new Headless Chrome experience. That’s fair! And I agree with his point of view.</p>
<h3 id="The-‘Selenium’-Empire"><a href="#The-‘Selenium’-Empire" class="headerlink" title="The ‘Selenium’ Empire"></a>The ‘Selenium’ Empire</h3><p><a href="https://www.seleniumhq.org/" target="_blank" rel="noopener">Selenium</a> is probably the most used browser automation and testing tool for frontend. It is the “Automation Emperor” for me. It has the most comprehensive coverage in terms of languages and target browsers. It has language binding for Java, Node, Ruby, Python, etc. You name it and it has language binding for it. And on the other side, it has web driver for every browser or browser like system. It has drivers for all browsers, Chrome, Safari, Firefox, Opera, etc. It also has drivers for like ok PhantomJS and Appium.</p>
<p>They have managed to achieve the most unimaginable feat. They have got these giants on a common footing. It enjoy a lot of love and support from community, including myself. So, why am I even talking about puppeteer.</p>
<p>That brings me nicely into the next piece. Architecture-wise Selenium and Puppeteer are slightly different. Selenium achieve browser automation though an intermediate proxy, the <a href="https://www.seleniumhq.org/projects/webdriver/" target="_blank" rel="noopener">WebDriver</a>. WebDriver is a per-browser component implementing remote control capabilities. It exposes an restful API interface. A language binding uses these APIs to interact and control browser.</p>
<p><img src="slides.012.jpeg" alt></p>
<p>Puppeteer takes a leaner approach to this and taps straight into the DevTools protocol of the browser. This makes it possible to easily keep keep with browser features and automation API, in sync.</p>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>Lets go through some samples to understand the development with Puppeteer.</p>
<h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><p>Puppeteer is a Node JS API. Its published as an NPM package. You can install it in you project with simple <code>npm install</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm i --save-dev puppeteer</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> puppeteer@0.12.0 install /Users/user/.nvm/project1/node_modules/puppeteer</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> node install.js</span></span><br><span class="line"></span><br><span class="line">Downloading Chromium r508693 - 72.6 Mb [====================] 100% 0.0s</span><br><span class="line">Chromium downloaded to /Users/monkey/project1/lib/node_modules/puppeteer/.local-chromium/mac-508693</span><br><span class="line">+ puppeteer@0.12.0</span><br><span class="line">added 42 packages in 223.254s</span><br></pre></td></tr></table></figure>

<p>Notice how it has also downloaded Chromium. This ensures that it has a compatible version of chromium always. You can skip Chromium download and run it with your own installation of Chrome / Chromium. You can skip download by setting an <code>PUPPETEER_SKIP_CHROMIUM_DOWNLOAD</code> environment variable. And you can provide executable path to alternate Chrome or Chromium in you code.</p>
<h3 id="Screenshot"><a href="#Screenshot" class="headerlink" title="Screenshot"></a>Screenshot</h3><p>Taking a screenshot in an automation tool is like a “Hello World!” thing.</p>
<figure class="highlight javascript"><figcaption><span>screenshot.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">"puppeteer"</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch();</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  <span class="keyword">await</span> page.goto(<span class="string">"https://www.google.com"</span>, &#123; <span class="attr">waitUntil</span>: <span class="string">"networkidle"</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.screenshot(&#123; <span class="attr">path</span>: <span class="string">"screenshot.png"</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p><a href="screenshot.js">Source</a></p>
<p>If you are not familiar with <code>async/await</code>, I would recommend reading <a href="https://medium.com/@tmvvr/ecmascript-async-await-to-the-rescue-fc379ff89146" target="_blank" rel="noopener">this</a>. Most methods in Puppeteer API return a Promise. <code>await</code> ensures that you wait for a promise to resolve or reject before proceeding to next instruction. Line <strong>5</strong>, invokes <code>launch()</code>, which launches Chromium. You can specify launch options as an object parameter, like <code>puppeteer.launch({headless: false})</code>. See all the options in <a href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#puppeteerlaunchoptions" target="_blank" rel="noopener">documentation</a> page. Line <strong>6</strong> creates a new tab with <code>newPage()</code> method. <code>goto()</code> method on line <strong>7</strong> navigates page to a URL. <code>waitUntil</code> ensures that page and its and related assets (js/images/css) are loaded, before promise is resolved.</p>
<p>On line <strong>10-12</strong>, <code>screenshot()</code> method captures an image of output and stores it in <code>screenshot.png</code>. This looks plain and simple. And that is what made me like this API. It is clean and simple.</p>
<p>You can run this with following command</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node screenshot.js</span></span><br><span class="line"><span class="meta">$</span><span class="bash"></span></span><br></pre></td></tr></table></figure>

<p>This produces <code>screenshot.png</code> in the current directory.</p>
<p><img src="screenshot.png" alt></p>
<h3 id="PDF"><a href="#PDF" class="headerlink" title="PDF"></a>PDF</h3><p>This is the single biggest reason for me to use Puppeteer. PDF generation is a breeze! Heres how you can do it.</p>
<figure class="highlight javascript"><figcaption><span>pdf.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">"puppeteer"</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch();</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  <span class="keyword">await</span> page.goto(<span class="string">"https://news.ycombinator.com"</span>, &#123; <span class="attr">waitUntil</span>: <span class="string">"networkidle"</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.pdf(&#123;</span><br><span class="line">    path: <span class="string">"hn.pdf"</span>,</span><br><span class="line">    format: <span class="string">"A4"</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p><a href="pdf.js">Source</a></p>
<p>We will now generate PDF from hacker news landing page. Code is not very different from what we saw in screenshot example. Line <strong>20-23</strong> generates PDF instead of screenshot. And thats it. You can specify paper size for the PDF in the optional argument. Look at <a href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pagepdfoptions" target="_blank" rel="noopener">documentation</a> for more options. Its output would be identical to “Print PDF” function of Chrome or Chromium. It uses print media css.</p>
<p><img src="hn.jpg" alt><br><a href="hn.pdf">Link to actual extracted PDF</a></p>
<h3 id="Web-Scraping"><a href="#Web-Scraping" class="headerlink" title="Web Scraping"></a>Web Scraping</h3><p>I have used Puppeteer most for this. In my work environment I have need for integration via web pages. There are case where I don’t have access to a data API for integration. Puppeteer can make it possible for you to expose a “web” site as a JSON api.</p>
<figure class="highlight javascript"><figcaption><span>scrape.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`use strict`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SELECTOR_BOOK_IMAGE =</span><br><span class="line">  <span class="string">"#default &gt; div &gt; div &gt; div &gt; div &gt; section &gt; div:nth-child(2) &gt; ol &gt; li:nth-child(1) &gt; article &gt; div.image_container &gt; a &gt; img"</span>;</span><br><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">"puppeteer"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> scrape = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123; <span class="attr">headless</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  <span class="keyword">await</span> page.goto(<span class="string">"http://books.toscrape.com/"</span>);</span><br><span class="line">  <span class="keyword">await</span> page.waitFor(<span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">await</span> page.click(SELECTOR_BOOK_IMAGE);</span><br><span class="line">  <span class="keyword">await</span> page.waitFor(<span class="number">2000</span>);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> page.evaluate(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> title = <span class="built_in">document</span>.querySelector(<span class="string">"h1"</span>).innerText;</span><br><span class="line">    <span class="keyword">let</span> price = <span class="built_in">document</span>.querySelector(<span class="string">".price_color"</span>).innerText;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      title,</span><br><span class="line">      price,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">scrape().then(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value); <span class="comment">// Success!</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a href="scrape.js">Source</a></p>
<p>We first goto “books.toscrape.com” and click on first image (line 11) on the page. First image on page is referred via <code>SELECTOR_BOOK_IMAGE</code> css selector. This triggers a navigation to a details page.</p>
<p>On line 13, a function is dispatched for evaluation on the DOM. This function goes through DOM element (<code>h1</code> and element with class <code>price_color</code> ) and extracts text (<code>innerText</code>).</p>
<p>You can simply run this with <code>node</code> command.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node scrape.js</span></span><br><span class="line">&#123; title: 'A Light in the Attic', price: '£51.77' &#125;</span><br></pre></td></tr></table></figure>

<p>You will see browser window for this example. This is because of line <strong>7</strong>, where I have opted for <code>{headless: false}</code>. This is to show scraping in action.</p>
<p><strong>Disclaimer:</strong> Be very careful what you scrape. You can/will run into legal and licensing issues very quickly.</p>
<h2 id="Final-Thoughts"><a href="#Final-Thoughts" class="headerlink" title="Final Thoughts"></a>Final Thoughts</h2><p>Puppeteer is a very promising project. In a very short period (&lt; 6 month) it has gotten great support from community. I have read many posts covering this API. I am confident about the future of this project. I am looking forward to a growing and thriving community for this.</p>
<p>It is a very good replacement for PhantomJS. However, my key concern as at the moment are:</p>
<ul>
<li>Google Cloud Function (GCF) does not support Node JS 6.4+. So, you have to use cloud VM or Container service to run this in cloud. Hopefully next version of LTS will be 8+, and will bring all the goodness of async/await into the mix</li>
<li>Lack of support for non-Chrome based browser could be discouraging for many developers. We all want to keep tool/library dependency low and single codebase for testing. If you project demands multi-browser testing, you will end up in a fractured state. Better stick with WebDriver/Selenium. May be WebDriver will adopt some part of Puppeteer API.</li>
</ul>
<p>I also found the e2e testing support very <em>unclean</em>. Its possible, workable, but now readable. I would like to see a very clean integration with likes of cucumber, mocha, chai, etc.</p>
<h3 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h3><p>Here are some links that I used for preparing my presentation.</p>
<ul>
<li><a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener">Puppeteer Home</a></li>
<li><a href="https://try-puppeteer.appspot.com/" target="_blank" rel="noopener">Try Puppeteer in Browser</a></li>
<li><a href="https://puppetron.now.sh/" target="_blank" rel="noopener">Puppetron</a> (<a href="https://www.youtube.com/watch?v=n4sRp3qe_1Y" target="_blank" rel="noopener">Demo</a>)</li>
<li><a href="https://developers.google.com/web/updates/2017/04/headless-chrome" target="_blank" rel="noopener">Getting Started with Headless Chrome - Eric Bidelman</a></li>
<li><a href="https://medium.com/@e_mad_ehsan/getting-started-with-puppeteer-and-chrome-headless-for-web-scrapping-6bf5979dee3e" target="_blank" rel="noopener">Getting Started with Puppeteer and Headless Chrome Web Scraping - Emad Ehsan</a></li>
<li><a href="https://codeburst.io/a-guide-to-automating-scraping-the-web-with-javascript-chrome-puppeteer-node-js-b18efb9e9921" target="_blank" rel="noopener">A Guide to Automating and Scraping - Brandon Morelli</a></li>
</ul>
<h3 id="Questions"><a href="#Questions" class="headerlink" title="Questions"></a>Questions</h3><p><strong>Can I use Puppeteer for extracting data and localizing?</strong><br>Technically, Yes. You can setup data pipeline to crawl and extract data. You case store it in database or some other persistent store. You can use a workflow to review, edit and publish. Be very careful about licensing. Don’t crawl/scrape data without author’s consent.</p>
<p><strong>Can you run multiple tabs simultaneously?</strong><br>Yes. You can use <code>newPage()</code> method to create multiple tabs. And for each tab you can have a different execution code. I have tried it with 2 tabs. Here is a code sample for the last example (scraping) that does same thing but five times, concurrently.</p>
<figure class="highlight javascript"><figcaption><span>scrape-multi.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SELECTOR_BOOK_IMAGE =</span><br><span class="line">  <span class="string">"#default &gt; div &gt; div &gt; div &gt; div &gt; section &gt; div:nth-child(2) &gt; ol &gt; li:nth-child(1) &gt; article &gt; div.image_container &gt; a &gt; img"</span>;</span><br><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">"puppeteer"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> scrapeSite = <span class="keyword">async</span> (browser) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  <span class="keyword">await</span> page.goto(<span class="string">"http://books.toscrape.com/"</span>);</span><br><span class="line">  <span class="keyword">await</span> page.waitFor(<span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">await</span> page.click(SELECTOR_BOOK_IMAGE);</span><br><span class="line">  <span class="keyword">await</span> page.waitFor(<span class="number">2000</span>);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> page.evaluate(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> title = <span class="built_in">document</span>.querySelector(<span class="string">"h1"</span>).innerText;</span><br><span class="line">    <span class="keyword">let</span> price = <span class="built_in">document</span>.querySelector(<span class="string">".price_color"</span>).innerText;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      title,</span><br><span class="line">      price,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> scrape = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123; <span class="attr">headless</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="built_in">Promise</span>.all([</span><br><span class="line">    scrapeSite(browser),</span><br><span class="line">    scrapeSite(browser),</span><br><span class="line">    scrapeSite(browser),</span><br><span class="line">    scrapeSite(browser),</span><br><span class="line">    scrapeSite(browser),</span><br><span class="line">  ]);</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">scrape().then(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value); <span class="comment">// Success!</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a href="scrape-multi.js">Source</a></p>
<p><strong>Can I extract CSS from the pages with this?</strong><br>I have not tried it, but as you can evaluate any valid javascript code using API, you should be able to extract that.</p>
<p>Below is a code that dumps each css being accessed by the page.</p>
<figure class="highlight javascript"><figcaption><span>scrape-dump-css.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">"puppeteer"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> scrape = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123; <span class="attr">headless</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> page.setRequestInterceptionEnabled(<span class="literal">true</span>);</span><br><span class="line">  page.on(<span class="string">"request"</span>, (r) =&gt; &#123;</span><br><span class="line">    r.continue();</span><br><span class="line">  &#125;);</span><br><span class="line">  page.on(<span class="string">"response"</span>, (r) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> url = r.url;</span><br><span class="line">    <span class="keyword">if</span> (url.endsWith(<span class="string">"css"</span>)) &#123;</span><br><span class="line">      r.text().then(<span class="function">(<span class="params">s</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"// Source:"</span> + url);</span><br><span class="line">        <span class="built_in">console</span>.log(s);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.goto(<span class="string">"http://books.toscrape.com/"</span>);</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;;</span><br><span class="line">scrape();</span><br></pre></td></tr></table></figure>

<p><a href="scrape-dump-css.js">Source</a></p>
<h2 id="Thanks"><a href="#Thanks" class="headerlink" title="Thanks"></a>Thanks</h2><p>My father (<a href="https://twitter.com/nmrampuria" target="_blank" rel="noopener">Shri. Noratan Rampuria</a>) has always been very supportive of my life and career choices. And he showed his support once again. He was there for my talk and had looked happy. Thanks papa 🙏!<br><img src="special-thanks.jpg" alt></p>
<p>Many ex and current colleagues were also at the event and showed their support. Thanks folks🤝!</p>
<p>Thanks to <a href="https://www.facebook.com/bharathi.subramanian.73" target="_blank" rel="noopener">Bharathi</a> and <a href="https://www.facebook.com/hari1prasath" target="_blank" rel="noopener">Hari</a> (GDG Mangement team) for the opportunity to speak. Well, it was more like <em>push</em> to speak 😀. <a href="https://www.facebook.com/manikantan.krish" target="_blank" rel="noopener">Manikantan K</a>, <a href="https://twitter.com/heliumlif" target="_blank" rel="noopener">Hui Yi</a>, <a href="https://twitter.com/dirkprimbs" target="_blank" rel="noopener">Dirk Primbs</a> and David from Google Developer Relations for supporting GDG-SG - “Thank you”. And <a href="https://twitter.com/perfinion" target="_blank" rel="noopener">Jason Zaman</a> for incepting the idea “Want to be at a conference? Just speak on something”.</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/gdg/">gdg</a> <a class="tag tag--primary tag--small t-link" href="/tags/testing/">testing</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2018/01/25/mobile-sites-certification/"
                    data-tooltip="Mobile Sites Certification"
                    aria-label="PREVIOUS: Mobile Sites Certification"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2017/09/19/kotlin-baby-steps/"
                    data-tooltip="Kotlin - Baby Steps"
                    aria-label="NEXT: Kotlin - Baby Steps"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?url=http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 Yogendra Rampuria. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2018/01/25/mobile-sites-certification/"
                    data-tooltip="Mobile Sites Certification"
                    aria-label="PREVIOUS: Mobile Sites Certification"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2017/09/19/kotlin-baby-steps/"
                    data-tooltip="Kotlin - Baby Steps"
                    aria-label="NEXT: Kotlin - Baby Steps"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?url=http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.linkedin.com/shareArticle?url=http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/"
                        aria-label="global.share_on_linkedin"
                    >
                        <i class="fab fa-linkedin" aria-hidden="true"></i><span>global.share_on_linkedin</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://www.gravatar.com/avatar/7ce74aebb97274e10ea8c5f2d9685abc?s=110" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Yogendra Rampuria</h4>
        
            <div id="about-card-bio"><p>Software Engineer<br>OSS Advocate, User, Buyer and Seller.<br>GPG: 019ECB5CDC6D59B7 </p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Senior Platform Architect<br>VMware / Pivotal</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Singapore
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover-yogi.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-sotevtnmobtyf1n4d3atbcsz9tjfnegyx7rivsk6hkdbzqltswlndxacw0um.min.js"></script>
<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'http://yogendra.github.io/2017/10/28/puppeteer-no-strings-attached/';
              
            this.page.identifier = '2017/10/28/puppeteer-no-strings-attached/';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'yogendrarampuria';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    




    </body>
</html>
